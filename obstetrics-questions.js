// obstetrics-questions.js - обновленная версия с гарантированным добавлением вопросов
(function() {
    // Объявляем переменную для отслеживания статуса загрузки
    window.obstetricsQuestionsLoaded = false;
    
    // Ждем полной загрузки DOM
    document.addEventListener('DOMContentLoaded', function() {
        addObstetricsQuestions();
    });
    
    function addObstetricsQuestions() {
        // Проверяем, существует ли массив вопросов
        if (typeof window.questions === 'undefined') {
            console.error('Массив вопросов не существует. Создаем новый.');
            window.questions = [];
        }
        
        // Префикс для ID вопросов
        const PREFIX = 'obs_';
        
        // Вопросы для режима Акушерство и гинекология - ОБЫЧНЫЙ УРОВЕНЬ
        const obstetricsQuestions = [
            {
                id: PREFIX + '001',
                text: "Какова продолжительность нормальной беременности?",
                options: ["36 недель", "40 недель", "42 недели", "44 недели"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '002',
                text: "Что такое гестационный возраст?",
                options: ["Возраст женщины на момент зачатия", "Возраст плода, отсчитываемый от момента зачатия", "Возраст плода, отсчитываемый от первого дня последней менструации", "Возраст новорожденного в первые дни после родов"],
                correctOptionIndex: 2,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '003',
                text: "Какие изменения не характерны для первого триместра беременности?",
                options: ["Тошнота и рвота", "Увеличение молочных желез", "Шевеления плода", "Частое мочеиспускание"],
                correctOptionIndex: 2,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '004',
                text: "Когда обычно начинаются шевеления плода у первородящих женщин?",
                options: ["8-10 недель", "12-14 недель", "18-20 недель", "24-26 недель"],
                correctOptionIndex: 2,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '005',
                text: "Что из перечисленного является физиологическим изменением при беременности?",
                options: ["Снижение объема циркулирующей крови", "Увеличение сердечного выброса", "Повышение артериального давления", "Снижение частоты дыхания"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '006',
                text: "Какой метод диагностики используется для определения беременности на раннем сроке?",
                options: ["Измерение температуры тела", "Определение уровня ХГЧ в моче или крови", "Измерение артериального давления", "Общий анализ крови"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '007',
                text: "Что такое плацента?",
                options: ["Оболочка, окружающая плод", "Орган, обеспечивающий связь между организмами матери и плода", "Околоплодные воды", "Слизистая оболочка матки"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '008',
                text: "Какой срок беременности считается доношенным?",
                options: ["32-36 недель", "37-42 недели", "38-44 недели", "42-44 недели"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '009',
                text: "Что такое преэклампсия?",
                options: ["Заболевание щитовидной железы при беременности", "Осложнение беременности, характеризующееся повышением артериального давления и протеинурией", "Инфекционное заболевание во время беременности", "Аллергическая реакция на гормоны беременности"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '010',
                text: "Что не является признаком начала родов?",
                options: ["Регулярные схватки", "Излитие околоплодных вод", "Отхождение слизистой пробки", "Повышение температуры тела"],
                correctOptionIndex: 3,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '011',
                text: "Какой период родов называется потужным?",
                options: ["Первый период", "Второй период", "Третий период", "Четвертый период"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '012',
                text: "Что такое послеродовый период?",
                options: ["Период подготовки организма к родам", "Период от начала регулярных схваток до рождения ребенка", "Период от рождения ребенка до рождения последа", "Период от момента рождения последа до инволюции матки (обычно 6-8 недель)"],
                correctOptionIndex: 3,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '013',
                text: "Какое положение плода считается физиологическим для родов?",
                options: ["Поперечное положение", "Косое положение", "Продольное положение головкой вниз", "Продольное положение тазовым концом вниз"],
                correctOptionIndex: 2,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '014',
                text: "Что такое амниотическая жидкость?",
                options: ["Жидкость, находящаяся в плаценте", "Жидкость, находящаяся в матке вне плодного пузыря", "Жидкость, окружающая плод в плодном пузыре", "Жидкость в маточных трубах"],
                correctOptionIndex: 2,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '015',
                text: "Какие изменения происходят в молочных железах при беременности?",
                options: ["Уменьшение размера", "Потемнение сосков и увеличение размера", "Исчезновение пигментации ареолы", "Уменьшение чувствительности"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '016',
                text: "Что такое послеродовая депрессия?",
                options: ["Снижение настроения в первые дни после родов из-за гормональных изменений", "Психическое расстройство, характеризующееся длительным подавленным настроением и другими симптомами после родов", "Нормальное состояние грусти после выписки из роддома", "Симптом недостатка витаминов"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '017',
                text: "Что такое ультразвуковое исследование в акушерстве?",
                options: ["Метод лечения плода", "Метод диагностики состояния плода и матки с помощью звуковых волн", "Способ стимуляции родовой деятельности", "Метод обезболивания родов"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '018',
                text: "Что такое фетальная тахикардия?",
                options: ["Замедление сердцебиения плода", "Учащение сердцебиения плода", "Нарушение ритма сердца плода", "Остановка сердца плода"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '019',
                text: "Какой скрининг проводится на сроке 11-14 недель беременности?",
                options: ["Проверка на сахарный диабет", "Проверка на пороки развития сердца", "Проверка на хромосомные аномалии и пороки развития нервной трубки", "Проверка на иммунитет к краснухе"],
                correctOptionIndex: 2,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '020',
                text: "Что такое многоплодная беременность?",
                options: ["Беременность с крупным плодом", "Беременность, при которой развивается более одного плода", "Повторная беременность в течение года", "Беременность с многоводием"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '021',
                text: "Какой метод обезболивания родов считается наиболее эффективным?",
                options: ["Применение наркотических анальгетиков", "Эпидуральная анестезия", "Ингаляция закиси азота", "Психопрофилактическая подготовка"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '022',
                text: "Что такое кесарево сечение?",
                options: ["Инструментальное родоразрешение с помощью щипцов", "Оперативное родоразрешение путем извлечения плода через разрез в матке", "Медикаментозная стимуляция родов", "Метод обезболивания родов"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '023',
                text: "Какой срок беременности считается недоношенным?",
                options: ["Менее 28 недель", "Менее 32 недель", "Менее 37 недель", "Менее 40 недель"],
                correctOptionIndex: 2,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '024',
                text: "Какой анализ обязательно проводится при постановке на учет по беременности?",
                options: ["Анализ на группу крови и резус-фактор", "МРТ головного мозга", "Анализ на уровень кортизола", "Электрокардиограмма"],
                correctOptionIndex: 0,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '025',
                text: "Что такое естественное вскармливание?",
                options: ["Кормление ребенка молочными смесями", "Кормление ребенка грудным молоком", "Кормление ребенка через зонд", "Кормление ребенка специальными питательными растворами"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '026',
                text: "Какой период принято называть перименопаузой?",
                options: ["Период полового созревания", "Период до наступления первой менструации", "Период от начала менопаузальных симптомов до года после последней менструации", "Период от рождения до полового созревания"],
                correctOptionIndex: 2,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '027',
                text: "Что такое цервикальная эрозия?",
                options: ["Воспаление шейки матки", "Дефект эпителия шейки матки", "Опухоль шейки матки", "Инфекционное заболевание шейки матки"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '028',
                text: "Какой день менструального цикла считается первым?",
                options: ["День овуляции", "Первый день месяца", "Первый день менструального кровотечения", "14-й день цикла"],
                correctOptionIndex: 2,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '029',
                text: "Каковы основные симптомы эндометриоза?",
                options: ["Повышение температуры и сыпь", "Кашель и одышка", "Болезненные менструации и боли при половом акте", "Отеки и повышение артериального давления"],
                correctOptionIndex: 2,
                mode: "obstetrics",
                difficulty: "easy"
            },
            {
                id: PREFIX + '030',
                text: "Что такое миома матки?",
                options: ["Воспаление матки", "Доброкачественная опухоль из мышечной ткани матки", "Злокачественная опухоль матки", "Аномалия развития матки"],
                correctOptionIndex: 1,
                mode: "obstetrics",
                difficulty: "easy"
            }
        ];
        
        // Добавляем вопросы в общий массив
        obstetricsQuestions.forEach(question => {
            // Проверяем, нет ли дубликатов
            const existingQuestion = window.questions.find(q => q.id === question.id);
            if (!existingQuestion) {
                window.questions.push(question);
            }
        });
        
        // Устанавливаем флаг загрузки
        window.obstetricsQuestionsLoaded = true;
        
        console.log(`Модуль "Акушерство и гинекология": добавлено ${obstetricsQuestions.length} вопросов`);
        
        // ВАЖНОЕ ДОБАВЛЕНИЕ: автоматическое инициирование режима акушерства
        // поскольку порядок загрузки скриптов все еще проблематичен
        setTimeout(addObstetricsMode, 500);
    }
    
    // Добавляем функцию создания режима напрямую из этого скрипта
    function addObstetricsMode() {
        // Проверяем, были ли добавлены вопросы
        const obstetricsQuestionsCount = Array.isArray(window.questions) 
            ? window.questions.filter(q => q.mode === 'obstetrics').length 
            : 0;
        
        if (obstetricsQuestionsCount === 0) {
            console.error('Вопросы для режима "Акушерство и гинекология" не найдены, кнопка не будет добавлена');
            return;
        }
        
        // Находим контейнер для кнопок режимов
        const modeContainer = document.querySelector('.quiz-mode-selection');
        if (!modeContainer) {
            console.error('Контейнер для кнопок режимов не найден');
            return;
        }
        
        // Проверяем, нет ли уже кнопки акушерства
        if (document.querySelector('.quiz-mode-btn[data-mode="obstetrics"]')) {
            console.log('Кнопка режима "Акушерство и гинекология" уже существует');
            return;
        }
        
        // Обновляем описания режимов
        if (window.modeDescriptions) {
            window.modeDescriptions['obstetrics'] = 'Вопросы о ведении беременности, родов и женском репродуктивном здоровье';
        }
        
        // Создаем кнопку режима
        const button = document.createElement('button');
        button.className = 'quiz-mode-btn';
        button.setAttribute('data-mode', 'obstetrics');
        button.textContent = 'Акушерство';
        
        // Добавляем стили для кнопки акушерства
        button.style.background = 'linear-gradient(135deg, #ec4899 0%, #d946ef 100%)';
        button.style.color = 'white';
        
        // Добавляем кнопку в контейнер
        modeContainer.appendChild(button);
        
        console.log('Кнопка режима "Акушерство и гинекология" успешно добавлена');
    }
})();
