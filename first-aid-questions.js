// first-aid-questions.js
(function() {
    // Ждем полной загрузки DOM
    document.addEventListener('DOMContentLoaded', function() {
        // Небольшая задержка для уверенности, что основной код загрузился
        setTimeout(initFirstAidQuestions, 500);
    });

    function initFirstAidQuestions() {
        // Проверяем, инициализирован ли массив вопросов
        if (typeof window.questions === 'undefined') {
            console.error('Массив вопросов не инициализирован. Убедитесь, что questions.js загружен раньше.');
            return;
        }
        
        // Уникальный префикс для избежания конфликтов ID
        const PREFIX = 'fa_2023_';
        
        // Проверяем существующие ID для предотвращения конфликтов
        const existingIds = window.questions.map(q => q.id.toString());
        
        // Вопросы для режима "Первая помощь"
        const firstAidQuestions = [
            // ПЕРВАЯ ПОМОЩЬ - ОБЫЧНЫЙ УРОВЕНЬ
            {
                id: PREFIX + '001',
                text: "Что необходимо сделать в первую очередь при артериальном кровотечении из конечности?",
                options: ["Наложить жгут", "Приложить холод", "Прижать артерию пальцем выше места кровотечения", "Обработать рану йодом"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '002',
                text: "Какое положение необходимо придать пострадавшему без сознания с сохраненным дыханием?",
                options: ["На спине с приподнятыми ногами", "На боку (устойчивое боковое положение)", "На спине с запрокинутой головой", "На животе"],
                correctOptionIndex: 1,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '003',
                text: "Что нельзя делать при ожоге?",
                options: ["Охлаждать место ожога холодной водой", "Накладывать чистую повязку", "Смазывать ожог маслом или жиром", "Давать обильное питье"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '004',
                text: "Как правильно проводить сердечно-легочную реанимацию взрослому?",
                options: ["30 нажатий на грудину, затем 2 вдоха", "15 нажатий на грудину, затем 1 вдох", "5 нажатий на грудину, затем 1 вдох", "60 нажатий на грудину, затем 2 вдоха"],
                correctOptionIndex: 0,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '005',
                text: "Какой должна быть глубина компрессий при СЛР взрослому человеку?",
                options: ["2-3 см", "4-5 см", "5-6 см", "7-8 см"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '006',
                text: "Что необходимо сделать при подозрении на перелом конечности?",
                options: ["Попытаться вправить кость", "Приложить тепло", "Иммобилизовать конечность", "Растереть место перелома"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '007',
                text: "Какой признак не характерен для артериального кровотечения?",
                options: ["Ярко-алый цвет крови", "Пульсирующая струя", "Быстрая кровопотеря", "Темный цвет крови"],
                correctOptionIndex: 3,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '008',
                text: "Как оказать первую помощь при обмороке?",
                options: ["Уложить пострадавшего с приподнятыми ногами", "Положить на спину и приподнять голову", "Оставить сидеть и наклонить голову вперед", "Поставить на ноги и заставить ходить"],
                correctOptionIndex: 0,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '009',
                text: "Какое действие следует предпринять при попадании инородного тела в дыхательные пути у взрослого человека?",
                options: ["Похлопать по спине и выполнить прием Геймлиха", "Дать выпить воды", "Вызвать рвоту", "Уложить пострадавшего и ждать бригаду скорой помощи"],
                correctOptionIndex: 0,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '010',
                text: "Что делать в первую очередь при химическом ожоге кожи?",
                options: ["Нанести нейтрализующее вещество", "Промыть большим количеством воды", "Наложить стерильную повязку", "Смазать место ожога растительным маслом"],
                correctOptionIndex: 1,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '011',
                text: "Какое положение следует придать пострадавшему при подозрении на инсульт?",
                options: ["Лежа на спине с приподнятым головным концом", "Лежа на животе", "Лежа на боку", "Сидя с опущенной головой"],
                correctOptionIndex: 0,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '012',
                text: "Что нужно сделать при укусе змеи?",
                options: ["Наложить жгут выше места укуса", "Разрезать место укуса и отсосать яд", "Иммобилизовать конечность и обеспечить покой", "Приложить тепло к месту укуса"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '013',
                text: "Как правильно остановить носовое кровотечение?",
                options: ["Запрокинуть голову назад", "Наклонить голову вперед и зажать крылья носа", "Положить на переносицу холодный компресс и лечь", "Промыть нос холодной водой"],
                correctOptionIndex: 1,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '014',
                text: "Какое действие необходимо выполнить при отморожении конечности?",
                options: ["Растереть снегом", "Поместить в горячую воду", "Постепенно согреть при комнатной температуре", "Смазать маслом или жиром"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '015',
                text: "Как правильно проверить наличие дыхания у пострадавшего?",
                options: ["Поднести зеркало ко рту", "Приложить палец к сонной артерии", "Наблюдать за движением грудной клетки, слушать и ощущать дыхание", "Проверить реакцию зрачков на свет"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '016',
                text: "Что делать при подозрении на перелом позвоночника?",
                options: ["Усадить пострадавшего", "Уложить на ровную твердую поверхность и не перемещать", "Помочь принять удобное положение", "Помочь дойти до машины скорой помощи"],
                correctOptionIndex: 1,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '017',
                text: "Какое мероприятие не относится к первой помощи при отравлении?",
                options: ["Вызов скорой помощи", "Промывание желудка", "Прием активированного угля", "Назначение антибиотиков"],
                correctOptionIndex: 3,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '018',
                text: "Что делать при поражении электрическим током?",
                options: ["Сразу приступить к реанимации", "Прежде всего освободить пострадавшего от воздействия тока", "Перенести пострадавшего в прохладное место", "Дать выпить горячий чай"],
                correctOptionIndex: 1,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '019',
                text: "Как помочь человеку в состоянии эпилептического припадка?",
                options: ["Удерживать конечности и голову", "Вставить что-нибудь между зубами", "Обеспечить безопасность, убрать опасные предметы и подложить что-то мягкое под голову", "Вызвать рвоту"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "easy"
            },
            {
                id: PREFIX + '020',
                text: "Какой признак не является признаком перелома?",
                options: ["Деформация конечности", "Отек и кровоподтек", "Болезненность при движении", "Повышение температуры тела"],
                correctOptionIndex: 3,
                mode: "first_aid",
                difficulty: "easy"
            },
                
            // ПЕРВАЯ ПОМОЩЬ - СЛОЖНЫЙ УРОВЕНЬ
            {
                id: PREFIX + '051',
                text: "При каком процентном поражении кожи ожогами можно говорить о тяжелом состоянии взрослого человека?",
                options: ["Более 5%", "Более 10%", "Более 25%", "Более 50%"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '052',
                text: "Что такое правило 'девяток' при оценке площади ожога?",
                options: ["Разделение тела на области по 9 кв.см.", "Критерий транспортировки в течение 9 минут", "Метод определения площади ожога, где различные части тела составляют 9% или кратные 9% от общей площади", "9 признаков глубокого ожога"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '053',
                text: "Какой период свободного утопления является критическим для успешной реанимации?",
                options: ["До 3 минут", "До 5 минут", "До 10 минут", "До 15 минут"],
                correctOptionIndex: 1,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '054',
                text: "Какое соотношение компрессий грудной клетки и вдохов является правильным при проведении СЛР у детей от 1 года до начала полового созревания одним спасателем?",
                options: ["15:2", "30:2", "5:1", "3:1"],
                correctOptionIndex: 1,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '055',
                text: "Каков основной механизм смерти при анафилактическом шоке?",
                options: ["Отек гортани с асфиксией", "Острая сердечная недостаточность", "Острый респираторный дистресс-синдром", "Все перечисленные механизмы"],
                correctOptionIndex: 3,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '056',
                text: "Какой вид транспортировки противопоказан при подозрении на перелом таза?",
                options: ["На щите в положении лягушки", "На носилках в положении на спине", "На жестких носилках в положении на животе", "Сидя в кресле"],
                correctOptionIndex: 3,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '057',
                text: "Какой тип кровотечения наиболее опасен при ранении шеи?",
                options: ["Капиллярное", "Венозное", "Артериальное", "Паренхиматозное"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '058',
                text: "Какое осложнение может возникнуть при нарушении правил наложения жгута?",
                options: ["Анафилактический шок", "Отек легких", "Ишемическое повреждение тканей, вплоть до некроза", "Септический шок"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '059',
                text: "Что является признаком эффективности компрессий грудной клетки при СЛР?",
                options: ["Наличие пульса на сонной артерии во время компрессий", "Расширение зрачков", "Появление самостоятельного дыхания", "Хруст ребер"],
                correctOptionIndex: 0,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '060',
                text: "Какой триады симптомов достаточно для постановки диагноза 'черепно-мозговая травма'?",
                options: ["Головная боль, тошнота, головокружение", "Потеря сознания, амнезия, рвота", "Кровотечение из уха, нарушение координации, сонливость", "Расширение зрачка, асимметрия лица, парезы конечностей"],
                correctOptionIndex: 1,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '061',
                text: "Какой тип шока развивается при тяжелом анафилактическом состоянии?",
                options: ["Кардиогенный", "Гиповолемический", "Дистрибутивный", "Обструктивный"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '062',
                text: "При отравлении каким веществом противопоказано вызывать рвоту?",
                options: ["Грибами", "Просроченными продуктами", "Едкими щелочами и кислотами", "Лекарственными препаратами"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '063',
                text: "Какой признак НЕ характерен для синдрома длительного сдавления?",
                options: ["Отек и деформация конечности", "Гиперемия кожи над местом сдавления", "Отсутствие чувствительности в сдавленной конечности", "Выраженная бледность кожи сдавленной конечности"],
                correctOptionIndex: 1,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '064',
                text: "Каковы признаки травматического шока 3 степени?",
                options: ["АД > 90 мм рт.ст., сознание ясное", "АД 90-70 мм рт.ст., сознание спутанное", "АД 70-50 мм рт.ст., сознание спутанное", "АД < 50 мм рт.ст., сознание отсутствует"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '065',
                text: "Через какое время после наложения жгута его необходимо ослабить для временного восстановления кровообращения?",
                options: ["Через 15 минут", "Через 30 минут", "Через 60 минут", "Через 120 минут"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '066',
                text: "Какое состояние может привести к остановке сердца у здорового молодого человека при ударе в область грудины?",
                options: ["Разрыв аорты", "Пневмоторакс", "Commotio cordis (сотрясение сердца)", "Тампонада сердца"],
                correctOptionIndex: 2,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '067',
                text: "Какое действие запрещено при оказании помощи при вывихе?",
                options: ["Иммобилизация конечности", "Холод на область вывиха", "Обезболивание", "Вправление вывиха на месте происшествия"],
                correctOptionIndex: 3,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '068',
                text: "Что является абсолютным признаком перелома?",
                options: ["Боль при движении", "Отек тканей", "Деформация конечности", "Патологическая подвижность в месте перелома"],
                correctOptionIndex: 3,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '069',
                text: "Какой основной механизм развития отека мозга при черепно-мозговой травме?",
                options: ["Нарушение венозного оттока", "Повышение проницаемости сосудов", "Нарушение ликвородинамики", "Все перечисленные механизмы"],
                correctOptionIndex: 3,
                mode: "first_aid",
                difficulty: "hard"
            },
            {
                id: PREFIX + '070',
                text: "Как правильно оценить тяжесть состояния пострадавшего с травмой по шкале комы Глазго?",
                options: ["По реакции зрачков на свет, сухожильным рефлексам и артериальному давлению", "По открыванию глаз, речевой реакции и двигательному ответу", "По наличию патологических рефлексов, тонусу мышц и частоте дыхания", "По состоянию сознания, частоте сердечных сокращений и наличию судорог"],
                correctOptionIndex: 1,
                mode: "first_aid",
                difficulty: "hard"
            }
        ];
        
        // Проверяем наши ID на конфликты с существующими
        const conflictIds = firstAidQuestions
            .filter(q => existingIds.includes(q.id.toString()))
            .map(q => q.id);
        
        if (conflictIds.length > 0) {
            console.warn(`Обнаружены конфликты ID: ${conflictIds.join(', ')}. Генерируем новые ID.`);
            
            // Для конфликтующих ID генерируем новые
            firstAidQuestions.forEach(q => {
                if (existingIds.includes(q.id.toString())) {
                    const newId = PREFIX + Date.now() + '_' + Math.floor(Math.random() * 10000);
                    console.log(`ID изменен: ${q.id} -> ${newId}`);
                    q.id = newId;
                }
            });
        }
        
        // Безопасно добавляем вопросы в массив
        window.questions = window.questions.concat(firstAidQuestions);
        console.log(`Модуль "Первая помощь": добавлено ${firstAidQuestions.length} вопросов`);
    }
})();
